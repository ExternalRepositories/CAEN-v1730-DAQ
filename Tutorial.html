<h2 id="tutorial">Tutorial for <a href="https://github.com/samdejong86/CAEN-v1730-DAQ" target="_blank">CAEN v1730 Digitizer DAQ</a></h2>

<p>For installation instuctions, see the <a href="https://github.com/samdejong86/CAEN-v1730-DAQ#installation" target="_blank"> README</a></p>

<h3 id="runningtheprogram">Running the program</h3>

<p>To display the DAQ command line parameters, run</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq -h
    
</code></pre>

<p>There are two ways to set the digitizer parameters: through the command line, or via an XML file. A simple run example is:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq --outfile FILE.root --duration 1000 --ch 0 --polarity0 POSITIVE --threshold0 100 --trslope0 POSITIVE
    
</code></pre>

<p>These same parameters can be set via an xml file:</p>

<pre style="background-color: #F7F7F7"><code>
    &lt;xml&gt;
      &lt;Active&gt;
        &lt;duration&gt;
          1000
        &lt;/duration&gt;
        &lt;outfile&gt;
          FILE.root
        &lt;/outfile&gt;
        &lt;ch0&gt;
          1
        &lt;/ch0&gt;
        &lt;polarity0&gt;
          POSITIVE
        &lt;/polarity0&gt;
        &lt;threshold0&gt;
          100
        &lt;/threshold0&gt;  
        &lt;trslope0&gt;
          POSITIVE
        &lt;/trslope0&gt;
      &lt;/Active&gt;
    &lt;/xml&gt;
    
</code></pre>

<p>which can be run with this command:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq -x XMLFILE.xml
    
</code></pre>

<p>assuming the xml file is named XMLFILE.xml. Any other command line arguments which set digitizer settings will be ignored if an xml file is specified.</p>

<p>Note that the xml tags are the same as the command line options, eg:</p>

<pre style="background-color: #F7F7F7"><code>
    --outfile FILE.root
    
</code></pre>

<p>on the command line is equivalent to</p>

<pre style="background-color: #F7F7F7"><code>
    &lt;outfile&gt;
      FILE.root
    &lt;/outfile&gt;
    
</code></pre>

<p>in the xml file.</p>

<p><details>
  <summary><strong>XML File Generation</strong></summary></p>

<p>The xml files used by the DAQ software can be created using a text editior, or by using the <code>--xmlout</code> command line argument. This argument will take the digitizer settings set at the command line and save them as an xml file:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq --outfile myfile.root --duration 3000 --ch 4 --polarity4 NEGATIVE --threshold4 100 --trslope4 NEGATIVE --xmlout mySettings.xml
    
</code></pre>

<p>will produce mySettings.xml, which will look like this:</p>

<pre style="background-color: #F7F7F7"><code>
    &lt;xml&gt;
      &lt;Active&gt;
        &lt;outfile&gt;
          myfile.root
        &lt;/outfile&gt;
        &lt;duration&gt;
          3000
        &lt;/duration&gt;
        &lt;ch4&gt;
          1
        &lt;/ch4&gt;
        &lt;polarity4&gt;
          NEGATIVE
        &lt;/polarity4&gt;
        &lt;threshold4&gt;
          100
        &lt;/threshold4&gt;
        &lt;trslope4&gt;
          NEGATIVE
        &lt;/trslope4&gt;
      &lt;/Active&gt;
    &lt;/xml&gt;
    
</code></pre>

<p>Adding <code>-q</code> on the command line will quit the DAQ after generating the xml file.</p>

<p></details></p>

<h3 id="Duration">Duration</h3>

<p>There are two ways of using the duration option.</p>
<details><summary>Number of events</summary>
<hr>
<p>If an integer is used as the parameter, that many events will be recorded. Example command:</p>


<pre style="background-color: #F7F7F7"><code>
    CAENdaq --duration 1000
    
</code></pre>


<p>or in XML:</p>
<pre style="background-color: #F7F7F7"><code>
    &lt;duration&gt; 
       1000    
    &lt;/duration&gt
    
</code></pre>

<p>will collect 1000 events before closing</p>
<hr>
</details>

<details><summary>Timed acquisition</summary>
<hr>
<p> If a time is specified in HH:MM:SS, events will be collected for that amount of time. Example command:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq --duration 01:30:00
    
</code></pre>
<p>or in XML:</p>
<pre  style="background-color: #F7F7F7"><code>
    &lt;duration&gt; 
       01:30:00   
    &lt;/duration&gt
    
</code></pre>

<p>will collect events for 90 minutes before closing</p>
<hr>
</details>

<h3 id="pulseandtriggerpolarity">Pulse and Trigger Polarity</h3>

<p>For a positive pulse, polarity&lt;CH&gt; should be set to POSITIVE, and for a negative pulse, it should be set to NEGATIVE. trslope&lt;CH&gt; may be set to POSITIVE or NEGATIVE depending on where the desired trigger point is. A general rule of thumb is that the trigger polarity and the pulse polarity should be the same.</p>

<details>
  <summary>Positive pulse with positive trigger</summary></p>
<hr>
<p><img src="img/PosPulsePosTrig.png" alt="Positive Pulse with Positive Trigger" title="Positive Pulse with Positive Trigger" /></p>

<p>Trigger will occur when the signal <strong>rises above</strong> 100. The red line is the trigger point.</p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --polarity0 POSITIVE --threshold0 100 --trslope0 POSITIVE
    
</code></pre>

<p><a href="xml/PositivePulsePositiveTrigger.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary>Positive pulse with negative trigger</summary></p>
<hr>
<p><img src="img/PosPulseNegTrig.png" alt="Positive Pulse with Negative Trigger" title="Positive Pulse with Negative Trigger" /></p>

<p>Trigger will occur when the signal <strong>falls below</strong> 100. The red line is the trigger point.</p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --polarity0 POSITIVE --threshold0 100 --trslope0 NEGATIVE
    
</code></pre>

<p><a href="xml/PositivePulseNegativeTrigger.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary>Negative pulse with positive trigger</summary></p>
<hr>
<p><img src="img/NegPulsePosTrig.png" alt="Negative Pulse with Positive Trigger" title="Negative Pulse with Positive Trigger" /></p>

<p>Trigger will occur when the signal <strong>rises above</strong> 100. The red line is the trigger point.</p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --polarity0 NEGATIVE --threshold0 100 --trslope0 POSITIVE
    
</code></pre>

<p><a href="xml/NegativePulsePositiveTrigger.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary>Negative pulse with negative trigger</summary></p>
<hr>
<p><img src="img/NegPulseNegTrig.png" alt="Negative Pulse with Negative Trigger" title="Negative Pulse with Negative Trigger" /></p>

<p>Trigger will occur when the signal <strong>falls below</strong> 100. The red line is the trigger point.</p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --polarity0 NEGATIVE --threshold0 100 --trslope0 NEGATIVE
    
</code></pre>

<p><a href="xml/NegativePulseNegativeTrigger.xml">Example xml file</a></p>
<hr>
<p></details>

<h3 id="recordlength">Record length</h3>

<p>The record length setting sets the number of samples in a waveform. A higher number will create a longer waveform.</p>

<details> <summary> Low record length </summary></p>

<p>In this example the record length is set to 512 samples.</p>

<p><img src="img/reclen_512.png" alt="Low record length" title="512 sample record length" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --reclen 512 --threshold0 100
    
</code></pre>

<a href="xml/RecordLength_512.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary> Medium record length </summary></p>
<hr>
<p>In this example the record length is set to 1024 samples (the default).</p>

<p><img src="img/reclen_1024.png" alt="mid record length" title="1024 sample record length" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --reclen 1024 --threshold0 100
    
</code></pre>

<p><a href="xml/RecordLength_1024.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary> High record length </summary></p>
<hr>
<p>In this example the record length is set to 2048 samples.</p>

<p><img src="img/reclen_2048.png" alt="high record length" title="2048 sample record length" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --reclen 2048 --threshold0 100
    
</code></pre>

<p><a href="xml/RecordLength_2048.xml">Example xml file</a></p>
<hr>
<p></details>

<h3 id="posttrigger">Post Trigger</h3>

<p>The post trigger setting sets how much of the waveform will be after the trigger occurs. valid settings are 0 to 100. Setting this to 50 is a good rule of thumb.</p>

<details> <summary> Post trigger of 0 </summary></p>
<hr>
<p><img src="img/postTrig_0.png" alt="post trigger 0" title="Post Trigger set to 0" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --posttrigger 0 --threshold0 100
    
</code></pre>

<p><a href="xml/PostTrigger_0.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary> Post trigger of 25 </summary></p>
<hr>
<p><img src="img/postTrig_25.png" alt="post trigger 25" title="Post Trigger set to 25" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --posttrigger 25 --threshold0 100
    
</code></pre>

<p><a href="xml/PostTrigger_25.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary> Post trigger of 50 (the default setting)</summary></p>
<hr>
<p><img src="img/postTrig_50.png" alt="post trigger 50" title="Post Trigger set to 50" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --posttrigger 50 --threshold0 100
    
</code></pre>

<p><a href="xml/PostTrigger_50.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary> Post trigger of 75 </summary></p>
<hr>
<p><img src="img/postTrig_75.png" alt="post trigger 75" title="Post Trigger set to 75" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --posttrigger 75 --threshold0 100
    
</code></pre>

<p><a href="xml/PostTrigger_75.xml">Example xml file</a></p>
<hr>
<p></details>

<details> <summary> Post trigger of 100 </summary></p>
<hr>
<p><img src="img/postTrig_100.png" alt="post trigger 100" title="Post Trigger set to 100" /></p>

<p>Example command line arguments:</p>

<pre  style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d 1000 --ch 0 --posttrigger 100 --threshold0 100
    
</code></pre>

<p><a href="xml/PostTrigger_100.xml">Example xml file</a></p>
<hr>
<p></details>

<h3 id="multichanneltriggering">Multi-Channel Triggering</h3>

<p>If mutiple channels have <code>--threshold&lt;CH&gt;</code> set, the triggers will be combined. There are two possibe modes for combining multiple trigger channels: <strong>AND</strong> and <strong>OR</strong>. The trigger mode is set with the <code>--triggermode</code> setting</p>

<details> <summary> Combining triggers with <strong>AND</strong></summary></p>

<p>Triggering will only occur when the trigger conditions are satisfied on all channels with <code>--threshold&lt;CH&gt;</code> set. For example:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d1000 --ch 0 --ch 1 --polarity0 POSITIVE --polarity1 POSITIVE --threshold0 100 --threshold1 100 \\
    --trslope0 POSITIVE --trslope1 POSITIVE --triggermode AND
    
</code></pre>

<p><a href="xml/ANDtrigger.xml">Example xml file</a></p>

<p>This will trigger when both channel 0 and channel 1 go above 100 ADC counts.</p>

<p>Note: AND is the default setting for <code>--triggermode</code>

<h4 id="coincidencewindow">Coincidence Window</h4>

<p>The <code>coincidencewindow</code> can be used to set the length of the window where the coincident triggers must occur, in units of 8ns. It takes an integer less than or equal to 15. For example:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq --triggermode AND --coincidencewindow 12
    
</code></pre>

<p>or in XML:</p>

<pre style="background-color: #F7F7F7"><code>
    &lt;triggermode&gt;
        AND
    &lt;/triggermode&gt;
    &lt;coincidencewindow&gt;
        12
    &lt;/coincidencewindow&gt;
    
</code></pre>

<p>will require a trigger on each trigger enabled channel within 96ns. The default value for this parameter is 10, or 80ns.</p>


</details>

<details> <summary>  Combining triggers with <strong>OR</strong></summary></p>

<p>Triggering will occur when the trigger conditions are satisfied on any channel. For example:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d1000 --ch 0 --ch 2 --polarity0 POSITIVE --polarity2 POSITIVE --threshold0 100 --threshold2 100 \\
    --trslope0 POSITIVE --trslope2 POSITIVE --triggermode OR
    
</code></pre>

<p><a href="xml/ORtrigger.xml">Example xml file</a></p>

<p>will trigger when either of channel 0 or channel 2 go abouve 100 ADC counts</p>

<h4 id="channelpairs">Channel Pairs</h5>

<p>The digitizer channels are paired together: 0&amp;1, 2&amp;3, 4&amp;5, 6&amp;7. If the triggermode is set to OR and triggering is enabled on both channels of a pair, the even channel is ignored and only the odd channel has a trigger applied. If OR triggering on multiple channels is required, the trigger must be applied on channels from seperate pairs. This is due to a limitation on the digitizer firmware.</p>

<p>For example:</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d1000 --ch 0 --ch 1 --threshold0 100 --threshold1 100 --triggermode OR
    
</code></pre>

<p>will only apply the trigger to channel 1, but</p>

<pre style="background-color: #F7F7F7"><code>
    CAENdaq -o FILE.root -d1000 --ch 0 --ch 2 --threshold0 100 --threshold2 100 --triggermode OR
    
</code></pre>

<p>will apply the trigger correctly to both channel 0 and channel 2</p>

<p></details>




<h3 id="datarecoveryincaseofprogramcrash">Data Recovery in Case of Program Crash</h3>

<p>When the program starts, it will create a temporary directory called <code>FILE_&lt;timestamp&gt;</code>, where <code>&lt;timestamp&gt;</code> is the unix time when the program started. Temporary root files containing <code>&lt;saveInterval&gt;</code> (set by the <code>saveInterval</code> parameter at the command line or in an xml file) events will be saved here.</p>

<p>When the program exits safely these files will be merged together, with the resulting file moved to the working directory. The temporary directory will then be removed. </p>

<p>If the program crashes, the temporary files will not be removed, so most of the data from the run can be recovered by looking in this directory.</p>

<h3 id="waveformdrawingscript">Waveform Drawing Script</h3>

<p>There is a ROOT script included with the repository called <code>draw.C</code>. This script can be used to display a waveform from a ROOT file created by the DAQ.</p>

<p>Usage:</p>

<pre style="background-color: #F7F7F7"><code>
    root[0] .x draw.C("FILE.root", channel, event)
    
</code></pre>

<p>where channel and event are integers for the channel number and event number.</p>

<p>This script can also be used as an example showing how to load waveforms, for use in an analysis.</p>


<h3 id="Calibration">Calibration</h3>

<p>A quick calibration was performed, yeilding this equation for converting ADC counts to mV:</p>

<pre style="background-color: #F7F7F7"><code>
    [Signal (mV)] = (0.1342 &plusmn 0.0005996)x[Signal (ADC counts)] - (1100 &plusmn 5.399)
    
</code></pre>

<p>and for converting mV to ADC counts:

<pre style="background-color: #F7F7F7"><code>
    [Signal (ADC counts)]=(7.451 &plusmn 0.0333)*[Signal (mV)] + (8203 &plusmn 16.1)

</code></pre>

<p> <strong>This calibration should not be trusted to high accuracy. </strong> If you require the voltage to be very accurate, you are advised to perform the calibration yourself.</p>
